{% extends 'base.html' %}
{% load static %}

{% block title %}Ø¯ÙˆÙ‘Ø±Ù‡Ø§ | Ù…Ù†ØµØ© Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©{% endblock %}

{% block content %}
<!-- Header -->
<img src="{% static 'images/sadu-strip.jpeg' %}" alt="Ø³Ø¯Ùˆ Ø¹Ù„ÙˆÙŠ" class="sadu-img">

<header class="hero">
    <img src="{% static 'images/logodw.png' %}" alt="Ø´Ø¹Ø§Ø± Ø¯ÙˆÙ‘Ø±Ù‡Ø§" class="hero-logo fade-in">
    <h1 class="hero-title fade-in">ğŸ¡ Ø¯ÙˆÙ‘Ø±Ù‡Ø§ | Ù…Ù†ØµØªÙƒ Ù„Ø§Ø¨ØªÙƒØ§Ø± ØªØ¬Ø§Ø±Ø¨ ÙØ±ÙŠØ¯Ø© Ù…Ø¹ Ø¹Ù…Ù„Ø§Ø¡Ùƒ</h1>
    <p class="fade-in">Ø³Ø¬Ù‘Ù„ Ø´Ø±ÙƒØªÙƒ Ù…Ø¹Ù†Ø§ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø®Ø§ØµØ© Ù…Ø¹ Ø¹Ø¬Ù„Ø© ØªÙØ§Ø¹Ù„ÙŠØ© ÙˆØ¬ÙˆØ§Ø¦Ø²Ùƒ Ø§Ù„Ø®Ø§ØµØ© âœ¨</p>
</header>

<!-- Registration Form -->
<section class="form-section fade-in" id="form">
    <h2>Ø³Ø¬Ù‘Ù„ Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ</h2>
    <p class="form-note">â­ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ø´Ø±ÙƒØ§Øª ÙÙ‚Ø·</p>
    
    <form id="leadForm" class="form">
        {% csrf_token %}
        <div class="grid">
            <label>
                Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø©
                <select name="type" id="typeSelect" required>
                    <option value="restaurant">Ù…Ø·Ø¹Ù…</option>
                    <option value="resort">Ù…Ù†ØªØ¬Ø¹</option>
                    <option value="hotel">ÙÙ†Ø¯Ù‚</option>
                    <option value="coffee">ÙƒÙˆÙÙŠ</option>
                    <option value="cafe">Ù…Ù‚Ù‡Ù‰</option>
                    <option value="event">ÙØ¹Ø§Ù„ÙŠØ©</option>
                    <option value="other">Ø£Ø®Ø±Ù‰</option>
                </select>
            </label>

            <label>
                Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©
                <input name="company" required>
            </label>

            <label id="customTypeLabel" class="full" style="display: none;">
                Ø§ÙƒØªØ¨ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø©
                <input name="customType" id="customTypeInput" placeholder="Ù…Ø«Ø§Ù„: ØµØ§Ù„ÙˆÙ†ØŒ Ø¹ÙŠØ§Ø¯Ø©ØŒ Ù…ØªØ¬Ø±...">
            </label>

            <label>
                Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                <input type="email" name="email" required>
            </label>

            <label>
                Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„
                <input name="phone">
            </label>

            <label class="full">
                Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø© ,)
                <textarea name="prizes" placeholder="Ø®ØµÙ… 10%, Ø®ØµÙ… 20%, Ù‚Ø³ÙŠÙ…Ø©, Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©"></textarea>
            </label>
        </div>

        <button type="submit" class="btn primary">Ø¥Ø±Ø³Ø§Ù„</button>
    </form>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Elements
const form = document.getElementById("leadForm");
const typeSelect = document.getElementById("typeSelect");
const customTypeLabel = document.getElementById("customTypeLabel");
const customTypeInput = document.getElementById("customTypeInput");

/**
 * Handle type selection change
 */
typeSelect.addEventListener("change", (e) => {
    if (e.target.value === "other") {
        customTypeLabel.style.display = "block";
        customTypeInput.required = true;
        customTypeInput.focus();
    } else {
        customTypeLabel.style.display = "none";
        customTypeInput.required = false;
        customTypeInput.value = "";
    }
});

/**
 * Show notification message
 */
function showNotification(message, type = "info") {
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }

    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <div style="
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'error' ? '#e74c3c' : type === 'success' ? '#2ecc71' : '#3498db'};
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10000;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        ">
            ${message}
        </div>
    `;

    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);

    document.body.appendChild(notification);

    setTimeout(() => {
        if (notification) {
            notification.style.animation = 'slideOut 0.3s ease-in';
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}

/**
 * Handle form submission
 */
form.addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    
    submitBtn.disabled = true;
    submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';

    try {
        const formData = new FormData(form);
        const data = {
            company: formData.get('company'),
            type: formData.get('type'),
            customType: formData.get('customType'),
            email: formData.get('email'),
            phone: formData.get('phone'),
            prizes: formData.get('prizes')
        };

        const response = await fetch('{% url "companies:register" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
            showNotification(result.message, "success");
            setTimeout(() => {
                window.location.href = result.redirect_url;
            }, 2000);
        } else {
            showNotification(result.message, "error");
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
        }

    } catch (error) {
        showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„", "error");
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
    }
});
</script>
{% endblock %}
