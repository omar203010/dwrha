# 📊 دليل إعداد نظام التقارير والتحليلات - دوّرها

## 🎯 نظرة عامة

تم تطوير "دوّرها" ليكون منصة تحليلية شاملة بالإضافة لكونه لعبة تفاعلية. الآن يوفر:
- ✅ حفظ تلقائي لبيانات كل دورة عجلة
- ✅ لوحة تحكم مخصصة لكل شركة
- ✅ لوحة تحكم إدارية شاملة لفريق دوّرها
- ✅ تقارير قابلة للتصدير (CSV)
- ✅ رسوم بيانية تفاعلية

---

## 📋 خطوات الإعداد

### 1️⃣ إنشاء جدول البيانات في Supabase

قم بتنفيذ السكريبت الموجود في `supabase-schema.sql` في لوحة Supabase:

1. افتح [Supabase Dashboard](https://app.supabase.com)
2. اذهب إلى **SQL Editor**
3. انسخ محتوى ملف `supabase-schema.sql` والصقه
4. اضغط **Run** لتنفيذ السكريبت

#### ما الذي سيتم إنشاؤه؟

**الجداول:**
- `game_spins` - سجل جميع دورات العجلة

**الـ Views (عروض البيانات):**
- `company_stats` - إحصائيات كل شركة
- `prize_distribution` - توزيع الجوائز
- `admin_stats` - إحصائيات إدارية عامة

**السياسات الأمنية:**
- Row Level Security لحماية البيانات
- سياسات قراءة وكتابة مناسبة

---

## 🗂️ هيكل البيانات

### جدول `game_spins`

| العمود | النوع | الوصف |
|--------|------|-------|
| `id` | BIGSERIAL | معرّف فريد |
| `company_id` | BIGINT | معرّف الشركة |
| `visitor_name` | TEXT | اسم الزائر |
| `prize` | TEXT | الجائزة المربوحة |
| `won` | BOOLEAN | هل فاز؟ (افتراضي: true) |
| `created_at` | TIMESTAMP | وقت الدورة |
| `session_id` | TEXT | معرّف الجلسة |
| `device_info` | TEXT | معلومات الجهاز (اختياري) |

---

## 📊 الصفحات الجديدة

### 1. لوحة تحكم الشركات
**الملف:** `company-dashboard.html`  
**الرابط:** `company-dashboard.html?id=COMPANY_ID`

**الميزات:**
- 📈 إحصائيات فورية (إجمالي الدورات، الزوار، دورات اليوم/الأسبوع)
- 🎁 رسم بياني لتوزيع الجوائز
- 📅 رسم بياني للدورات خلال آخر 7 أيام
- 🕒 قائمة بآخر 10 دورات
- 📥 تصدير البيانات إلى CSV
- 🎡 رابط سريع للعودة للعجلة

**من يراها؟**
- الشركة المسجلة فقط (بيانات خاصة بها)

---

### 2. لوحة التحكم الإدارية
**الملف:** `admin-dashboard.html`  
**الرابط:** `admin-dashboard.html`

**الميزات:**
- 🏢 إحصائيات شاملة لجميع الشركات
- 🎡 إجمالي الدورات عبر جميع الشركات
- 👥 إجمالي الزوار الفريدين
- 📈 رسم نمو الدورات خلال آخر 30 يوم
- 🏆 أفضل 5 شركات من حيث التفاعل
- 📋 جدول تفصيلي بأداء كل شركة
- 📥 تصدير تقارير شاملة (CSV)

**من يراها؟**
- فريق دوّرها الإداري فقط
- ⚠️ **مهم:** لا تشارك هذا الرابط مع الشركات!

---

## 🔄 سير العمل

### رحلة المستخدم النهائي (العميل):
1. يفتح صفحة العجلة → `company.html?id=123`
2. يدخل اسمه
3. يضغط "ابدأ اللعب" → تظهر العجلة
4. يضغط "جرّب حظك" → تدور العجلة
5. **💾 يتم حفظ البيانات تلقائياً في `game_spins`**
6. تظهر رسالة الفوز
7. يضغط "استلام الجائزة" → الصفحة تُعاد تحميلها للعميل التالي

### رحلة صاحب الشركة:
1. يسجل شركته في `index.html`
2. يصل لصفحة الشكر `thanks.html`
3. يرى رابطين:
   - 🎡 رابط العجلة (للعملاء)
   - 📊 **رابط لوحة التحكم والتقارير** (جديد!)
4. يفتح لوحة التحكم ليرى:
   - عدد العملاء المشاركين
   - الجوائز الأكثر توزيعاً
   - إحصائيات يومية وأسبوعية
5. يمكنه تصدير التقرير إلى CSV

### رحلة فريق دوّرها:
1. يفتح `admin-dashboard.html`
2. يرى إحصائيات شاملة لجميع الشركات
3. يحلل أداء كل شركة
4. يعرف أكثر الشركات نشاطاً
5. يُصدّر تقارير تفصيلية للتحليل

---

## 📥 التقارير القابلة للتصدير

### تقرير الشركة (CSV):
- التاريخ والوقت
- اسم الزائر
- الجائزة
- Session ID

### التقرير الإداري الشامل:
- بيانات جميع الدورات من جميع الشركات
- ملخص أداء كل شركة

---

## 🔐 الأمان والخصوصية

✅ **بيانات الشركات منفصلة تماماً**  
- كل شركة ترى بياناتها فقط
- لا يمكن لشركة الوصول لبيانات شركة أخرى

✅ **لوحة الإدارة محمية**  
- للاستخدام الداخلي فقط
- يمكن إضافة مصادقة لاحقاً (Authentication)

✅ **Row Level Security مُفعّل**  
- سياسات حماية على مستوى الصفوف
- يمكن تطويرها حسب الحاجة

---

## 🚀 الخطوات التالية (اختياري)

### تحسينات مقترحة:

1. **إرسال تقارير تلقائية بالبريد:**
   - استخدام Edge Functions في Supabase
   - إرسال تقرير يومي لكل شركة

2. **نظام مصادقة:**
   - إضافة تسجيل دخول للشركات
   - تسجيل دخول منفصل للإدارة

3. **تقارير PDF:**
   - تحويل التقارير إلى PDF
   - إضافة الشعارات والتصميمات

4. **إشعارات فورية:**
   - إشعار للشركة عند كل دورة عجلة
   - Dashboard يتحدث لحظياً

5. **تحليلات متقدمة:**
   - معدلات التحويل
   - أوقات الذروة
   - أيام الأسبوع الأكثر نشاطاً

---

## 📞 الدعم

إذا واجهت أي مشاكل:
1. تأكد من تنفيذ سكريبت SQL بنجاح
2. تحقق من وجود أخطاء في Console المتصفح
3. تأكد من صلاحيات Supabase

---

## ✨ ملخص الملفات الجديدة

| الملف | الوصف |
|------|-------|
| `supabase-schema.sql` | سكريبت إنشاء الجداول والـ Views |
| `company-dashboard.html` | لوحة تحكم الشركات |
| `admin-dashboard.html` | لوحة التحكم الإدارية |
| `wheel.js` (محدّث) | إضافة حفظ البيانات تلقائياً |
| `thanks.html` (محدّث) | إضافة رابط لوحة التحكم |
| `SETUP-GUIDE.md` | هذا الدليل |

---

**🎉 الآن "دوّرها" جاهزة كمنصة تحليلية احترافية!**

